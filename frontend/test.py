import fitz  # PyMuPDF

def highlight_without_flip(input_pdf, output_pdf, coord_data):
    """
    Adds highlight annotations to a PDF based on coordinate data (no flipping).
    
    Parameters:
      input_pdf (str): Path to the input PDF file.
      output_pdf (str): Path to save the output PDF with highlights.
      coord_data (dict): Dictionary with keys: "x0", "x1", "top", "bottom", "page".
                         Page numbers are 0-indexed (first page is 0).
    """
    # Open the PDF document
    doc = fitz.open(input_pdf)

    # Loop through all coordinate entries
    for i in range(len(coord_data["x0"])):
        page_index = coord_data["page"][i]
        page = doc[page_index]

        x0 = coord_data["x0"][i]
        x1 = coord_data["x1"][i]
        top = coord_data["top"][i]
        bottom = coord_data["bottom"][i]

        rect = fitz.Rect(x0, top, x1, bottom)
        page.add_highlight_annot(rect)

    # Save the modified PDF
    doc.save(output_pdf)
    doc.close()


if __name__ == "__main__":
    # File paths
    input_pdf = "/Users/philipp/Documents/intership-projects-2025-main/notebooks/contract-samples/professional-services-agreement-1.pdf"
    output_pdf = "/Users/philipp/Documents/intership-projects-2025-main/notebooks/contract-samples/output.pdf"

    # Full coordinate data
    data = {
        "x0": [73.49986799999999, 98.26415999999999, 127.92553199999999, 151.48202400000002, 189.339966, 206.165718, 222.99147, 236.13892199999998, 270.031986, 284.11273800000004, 300.26322000000005, 348.84423, 405.26386199999996, 459.73564200000004, 488.71405800000014, 500.6493180000001, 73.49986799999999, 97.02341999999999, 108.94330799999999, 127.662012, 139.58190000000002, 164.93911200000002, 193.3213140000001, 205.24120200000007, 272.15661600000004, 290.777598, 332.65092599999997, 348.24033, 385.229754, 433.21674600000006, 73.49986799999999, 133.929396, 184.11238800000004, 231.0683580000001, 243.0058140000001],
        "x1": [95.49280799999998, 125.15417999999998, 148.710672, 186.629004, 203.394366, 220.22011799999999, 233.36757, 267.260634, 281.34138600000006, 297.552258, 346.06958399999996, 402.48921599999994, 456.960996, 485.93941200000006, 497.87467200000015, 554.3920260000001, 94.25645999999999, 106.17634799999999, 124.811604, 136.81494, 162.17215200000004, 190.49506200000005, 202.47424200000006, 269.38965600000006, 288.008442, 329.88177, 345.471174, 382.460598, 430.44759, 503.78520600000013, 131.153652, 181.33664400000004, 228.2926140000001, 240.2300700000001, 279.4067100000001],
        "top": [564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 564.3303600000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 576.9903000000002, 589.5898500000001, 589.5898500000001, 589.5898500000001, 589.5898500000001, 589.5898500000001],
        "bottom": [575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 575.3103600000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 587.9703000000001, 600.5698500000001, 600.5698500000001, 600.5698500000001, 600.5698500000001, 600.5698500000001],
        "page": [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
    }

    highlight_without_flip(input_pdf, output_pdf, data)
    print(f"Highlight added and saved to {output_pdf}")
